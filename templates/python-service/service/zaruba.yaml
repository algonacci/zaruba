env:
  SERVICENAME_HTTP_PORT: 3010

components:

  servicename-prep:
    type: command
    labels:
      scenario: preparation
    start: pipenv sync

  servicename-test:
    type: command
    labels:
      scenario: test
    env:
      SERVICENAME_HTTP_PORT: 4010
      TEST_RMQ_CONNECTION_STRING: amqp://${RMQ_USER}:${RMQ_PASS}@${rmq}:${RMQ_PORT}/
    start: pipenv run python -m pytest
    dependencies:
      - servicename-prep
      - rmq

  servicename:
    type: service
    labels:
      scenario: default
    origin: "" # fill this one with your git repository
    env:
      SERVICENAME_HTTP_PORT: ${SERVICENAME_HTTP_PORT}
      DEFAULT_RMQ_CONNECTION_STRING: amqp://${RMQ_USER}:${RMQ_PASS}@${rmq}:${RMQ_PORT}/
    start: pipenv run python main.py
    readinessUrl: http://${servicename}:${SERVICENAME_HTTP_PORT}/readiness
    dependencies:
      - servicename-prep
      - rmq

links:
  ../../libraries/python/transport:
    - ./transport
  ../../libraries/python/core:
    - ./core

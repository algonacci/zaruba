tasks:

  createZarubaServiceNameDb:
    extend: zarubaAirflowPostgreServiceExecSql
    dependencies:
      - zarubaAirflowPostgreTask
    config:
      queries: 'CREATE DATABASE {{ .GetConfig "dbName" }}'
    configRef: createZarubaServiceNameDb
    envRef: createZarubaServiceNameDb

  configureZarubaServiceName:
    extend: core.runInDockerContainer
    location: ../../zarubaServiceName
    dependencies:
      - runZarubaServiceNameConfigurator
    config:
      containerShell: bash
      commands: |
        airflow version
        airflow db upgrade
        airflow users create \
          --username "{{ .GetConfig "wwwUserName" }}" \
          --password "{{ .GetConfig "wwwPassword" }}" \
          --firstname "{{ .GetConfig "wwwFirstName" }}" \
          --lastname "{{ .GetConfig "wwwLastName" }}" \
          --role "{{ .GetConfig "wwwRole" }}" \
          --email "{{ .GetConfig "wwwEmail" }}"
        {{ .ParseFile "configurator.gotmpl.sh"}}
    configRef: zarubaServiceNameConfigurator
    envRef: zarubaServiceNameConfigurator
  
  configureZarubaServiceNameWorker:
    extend: core.runInDockerContainer
    location: ../../zarubaServiceName
    dependencies:
      - runZarubaServiceNameWorker
    config:
      containerShell: bash
      commands: |
        {{ .ParseFile "worker.gotmpl.sh"}}
    configRef: zarubaServiceNameWorker
    envRef: zarubaServiceNameWorker
  


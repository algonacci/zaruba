tasks:

  createZarubaServiceNameConfiguratorScript:
    extend: core.runShellScript
    location: ../../zarubaServiceName/airflow
    config:
      start: |
        {{ $err := .WriteFile (.GetRelativePath "../../zarubaServiceName/airflow/init.sh") (.ParseFile (.GetRelativePath "../../zarubaServiceName/airflow/init.gotmpl.sh")) }}
    configRefs:
      - zarubaServiceNameContainer
      - zarubaServiceName
    envRef: zarubaServiceName

  configureZarubaServiceNameAirflow:
    extend: configureZarubaAirflowServiceWorker
    location: ../../zarubaServiceName/airflow
    dependencies:
      - createZarubaServiceNameConfiguratorScript
      - runZarubaAirflowServiceWorker
    config:
      commands: |
        {{ .ReadFile (.GetRelativePath "../../zarubaServiceName/airflow/init.sh") }}
  
  registerZarubaServiceName:
    extend: core.runShellScript
    location: ../../zarubaServiceName/airflow
    dependencies:
      - configureZarubaServiceNameAirflow
      - buildZarubaServiceNameImage
    configRefs:
      - zarubaAirflowServiceWorker
      - zarubaAirflowServiceContainer
    config:
      start: |
        docker cp "./dags" "{{ .GetConfig "containerName" }}:/opt/airflow/dags/zarubaServiceName"

    
tasks:

  createZarubaServiceNameConfiguratorScript:
    extend: core.runShellScript
    location: ../../zarubaServiceName/airflow
    config:
      start: |
        {{ $err := .WriteFile "init.sh" (.ParseFile "init.gotmpl.sh") }}
    configRefs:
      - zarubaServiceNameContainer
      - zarubaServiceName
      - coreDocker
    envRef: zarubaServiceName

  configureZarubaServiceNameAirflow:
    extend: configureZarubaAirflowServiceWorker
    location: ../../zarubaServiceName/airflow
    dependencies:
      - createZarubaServiceNameConfiguratorScript
      - runZarubaAirflowServiceWorker
    config:
      commands: |
        {{ .ReadFile "airflow/init.sh" }}
  
  registerZarubaServiceName:
    extend: core.runShellScript
    location: ../../zarubaServiceName/airflow
    dependencies:
      - configureZarubaServiceNameAirflow
      - buildZarubaServiceNameImage
    configRefs:
      - zarubaAirflowServiceWorker
      - zarubaAirflowServiceContainer
    config:
      start: |
        docker cp "./dags" "{{ .GetConfig "containerName" }}:/opt/airflow/dags/zarubaServiceName"

    
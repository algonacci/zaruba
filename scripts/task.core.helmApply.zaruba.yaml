tasks:

  core.helmApply:
    icon: ðŸš¢
    private: true
    description: |
      Apply helm charts by using helmfile.
      Common config:
        dockerEnv   : docker environment key (default: '{{ .GetValue "dockerEnv" }}')
        helmEnv     : helm environment key (default: '{{ .GetValue "helmEnv" }}')
        kubeContext : kubernetes context (default: '{{ .GetValue "kube.content" }}')
    extend: core.runCoreScript
    configRef: coreDocker
    config:
      helmEnv: '{{ .GetValue "helmEnv" }}'
      kubeContext: '{{ .GetValue "kubeContext" }}'
      start: |
        {{ .Trim (.GetConfig "initDockerImagePrefixScript") "\n" }}
        KUBE_CONTEXT="{{ .GetConfig "kubeContext" }}"
        kubectl config use-context "${KUBE_CONTEXT}"
        export IMAGE_PREFIX="${DOCKER_IMAGE_PREFIX}"
        helmfile --environment "{{ .GetConfig "helmEnv" }}" sync


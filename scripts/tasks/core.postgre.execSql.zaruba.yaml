tasks:
     
  core.postgre.execSql:
    icon: üê¨ 
    private: true
    extend: core.runCoreScript
    config:
      user: '{{ .GetEnv "POSTGRES_USER" }}'
      password: '{{ .GetEnv "POSTGRES_PASSWORD" }}'
      database: '{{ .GetEnv "POSTGRES_DB" }}'
      queries: ""
      containerName: ""
      _start: |
        {{ $localTmpFile := .GetWorkPath (printf "tmp/%s.%s.sql" .Name .GetNewUUID) -}}
        {{ $err := .WriteFile $localTmpFile (.GetConfig "queries") -}}
        USER="{{ .GetConfig "user" }}"
        PASSWORD="{{ .GetConfig "password" }}"
        CONTAINER_NAME="{{ .GetConfig "containerName" }}"
        LOCAL_TMP_FILE="{{ $localTmpFile }}"
        CONTAINER_TMP_FILE="/{{ .Name }}.{{ .GetNewUUID }}.tmp.sql"
        docker cp "${LOCAL_TMP_FILE}" "${CONTAINER_NAME}:${CONTAINER_TMP_FILE}"
        rm "${LOCAL_TMP_FILE}"
        docker exec "${CONTAINER_NAME}" bash -c "psql --user=${USER} -w --file=${CONTAINER_TMP_FILE}"
        docker exec "${CONTAINER_NAME}" rm "${CONTAINER_TMP_FILE}"
      start: ""


tasks:
     
  core.postgre.execSql:
    icon: üê¨ 
    private: true
    extend: core.runInDockerContainer
    config:
      user: '{{ .GetEnv "POSTGRES_USER" }}'
      password: '{{ .GetEnv "POSTGRES_PASSWORD" }}'
      database: '{{ .GetEnv "POSTGRES_DB" }}'
      queries: ""
      containerName: ""
      _template: '{{ .GetConfig "queries" }}'
      _localScriptFile: '{{ .GetWorkPath (printf "tmp/%s.tmp.sql" .Name) }}'
      _remoteScriptFile: '/{{ .Name }}.tmp.sql'
      _executeScript: |
        REMOTE_SCRIPT_FILE="{{ .GetConfig "_remoteScriptFile" }}"
        CONTAINER_NAME="{{ .GetConfig "containerName" }}"
        USER="{{ .GetConfig "user" }}"
        PASSWORD="{{ .GetConfig "password" }}"
        docker exec "${CONTAINER_NAME}" bash -c "psql --user=${USER} -w --file=${REMOTE_SCRIPT_FILE}"
        docker exec -u 0 "${CONTAINER_NAME}" rm "${REMOTE_SCRIPT_FILE}"

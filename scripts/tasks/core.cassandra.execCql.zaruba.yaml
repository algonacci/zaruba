tasks:
     
  core.cassandra.execCql:
    icon: ðŸ‘€
    private: true
    extend: core.runCoreScript
    configRef: coreDocker
    config:
      user: cassandra
      password: cassandra
      keyspace: sample
      queries: ""
      containerName: ""
      _start: |
        {{ $localTmpFile := printf "%s.tmp.sql" .GetNewUUID -}}
        {{ $err := .WriteFile $localTmpFile (.GetConfig "queries") -}}
        USER="{{ .GetConfig "user" }}"
        PASSWORD="{{ .GetConfig "password" }}"
        CONTAINER_NAME="{{ .GetConfig "containerName" }}"
        LOCAL_TMP_FILE="{{ $localTmpFile }}"
        CONTAINER_TMP_FILE="/{{ .GetNewUUID }}.tmp.sql"
        docker cp "${LOCAL_TMP_FILE}" "${CONTAINER_NAME}:${CONTAINER_TMP_FILE}"
        rm "${LOCAL_TMP_FILE}"
        docker exec "${CONTAINER_NAME}" cqlsh -u "${USER}" -p "${PASSWORD}" -f "${CONTAINER_TMP_FILE}"
        docker exec "${CONTAINER_NAME}" rm "${CONTAINER_TMP_FILE}"
      start: ""
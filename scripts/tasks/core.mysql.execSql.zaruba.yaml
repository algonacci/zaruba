tasks:
      
  core.mysql.execSql:
    icon: üê¨ 
    private: true
    extend: core.runCoreScript
    config:
      user: root
      password: '{{ .GetEnv "MYSQL_ROOT_PASSWORD" }}'
      database: '{{ .GetEnv "MYSQL_DATABASE" }}'
      queries: ""
      containerName: ""
      _start: |
        {{ $localTmpFile := .GetWorkPath (printf "tmp/%s.%s.sql" .Name .GetNewUUID) -}}
        {{ $err := .WriteFile $localTmpFile (.GetConfig "queries") -}}
        USER="{{ .GetConfig "user" }}"
        PASSWORD="{{ .GetConfig "password" }}"
        CONTAINER_NAME="{{ .GetConfig "containerName" }}"
        LOCAL_TMP_FILE="{{ $localTmpFile }}"
        CONTAINER_TMP_FILE="/{{ .Name }}.{{ .GetNewUUID }}.tmp.sql"
        docker cp "${LOCAL_TMP_FILE}" "${CONTAINER_NAME}:${CONTAINER_TMP_FILE}"
        rm "${LOCAL_TMP_FILE}"
        docker exec "${CONTAINER_NAME}" bash -c "mysql --user=\"${USER}\" --password=\"${PASSWORD}\" < \"${CONTAINER_TMP_FILE}\""
        docker exec "${CONTAINER_NAME}" rm "${CONTAINER_TMP_FILE}"
      start: ""


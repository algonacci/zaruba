inputs:

  generatorDockerImageName:
    description: Docker image name (Required)
    prompt: Docker image name
    validation: ^[a-z0-9_]+$


  generatorDockerContainerName:
    description: Docker container name (Can be blank)
    prompt: Docker container name
    validation: ^[a-zA-Z0-9_]*$

  
  generatorServiceName:
    description: Service name (Can be blank)
    prompt: Service name
    validation: ^[a-zA-Z0-9_]*$


  generatorServicePorts:
    description: |
      Service ports (number or environment variable), comma separated.
      E.g: 3000,HTTP_PORT,PROMETHEUS_PORT
    prompt: "Service ports"
    validation: ^[a-zA-Z0-9_,]*$
  

  generatorServiceEnvs:
    description: |
      Service environments, comma separated.
      E.g: HTTP_PORT=3000,MODE=writer

      Many applications rely on environment variables to configure their behavior.
      You might need to see service's documentation or open environment files (.env, template.env, etc) to see available options.
      If there is no documentation/environment files available, you probably need to run-through the code or ask the developer team.
    prompt: "Service environments"


  generatorTaskDependencies:
    description: |
      Task's dependencies, comma separated.
      E.g: runMysql, runRedis

      For example, you want to make sure that MySQL and Redis is already running before starting this task.

      In that case, assuming runMySql and runRedis are tasks to run MySQL and Redis respectively, then you need to set this task's dependencies into:
        runMysql,runRedis
    prompt: "Task dependencies"


  generatorServiceLocation:
    description: Service location, relative to this directory
    prompt: "Service location"
    validation: ^.+$


  generatorServiceDockerImageName:
    description: |
      Service's docker image name (Can be blank)
    prompt: Service's docker image name
    validation: ^[a-z0-9_]*$


  generatorServiceDockerContainerName:
    description: |
      Service's docker container name (Can be blank)
    prompt: Service's docker container name
    validation: ^[a-zA-Z0-9_]*$


  generatorServiceStartCommand:
    description: Command to start the service (Required)
    prompt: Start command
    validation: ^.+$


  generatorGoServiceStartCommand:
    description: Command to start the service (Required)
    prompt: Start command
    default: go run .
    validation: ^.+$


  generatorNodeJsServiceStartCommand:
    description: Command to start the service (Required)
    prompt: Start command
    options:
    - npm start
    - node start
    - node main
    - node index
    default: npm start
    validation: ^.+$


  generatorNodeJsServiceRunnerVersion:
    description: NodeJs version (Required)
    prompt: NodeJs version
    options: [node, 16, 15, 14, 13, 12, 11, 10]
    default: node
    validation: ^.+$

   
  generatorPythonServiceStartCommand:
    description: Command to start the service (Required)
    prompt: Start command
    options:
    - pipenv run python start.py
    - pipenv run python main.py
    - pipenv run python index.py
    default: pipenv run python start.py
    validation: ^.+$


  generatorFastApiCreateTask:
    description: Create service task if not exist.
    prompt: Create service task if not exist
    options: [yes, no]
    default: no
    allowCustom: false

  
  generatorFastApiServiceName:
    description: Service name (Required)
    prompt: Service name
    validation: ^[a-zA-Z0-9_]+$


  generatorFastApiModuleName:
    description: Module name (Required)
    prompt: Module name
    validation: ^[a-zA-Z0-9_]+$


  generatorFastApiUrl:
    description: |
      URL to be handled (Required)
    prompt: URL to be handled
    validation: ^[a-zA-Z0-9_\-/\{\}]+$


  generatorFastApiHttpMethod:
    description: HTTP Method (Required)
    prompt: HTTP Method
    options: [get, post, put, delete]
    default: get
    validation: ^[a-z]+$
    allowCustom: false


  generatorFastApiEventName:
    description: |
      Event name (Required)
    prompt: Event name
    validation: ^[a-zA-Z0-9_\-\.]+$


  generatorFastApiRpcName:
    description: |
      RPC name (Required)
    prompt: RPC name
    validation: ^[a-zA-Z0-9_\-\.]+$

 
  generatorFastApiCrudEntity:
    description: |
      Entity name (Required)
      Usually plural word (e.g: books, articles)
    prompt: Entity name
    validation: ^[a-zA-Z0-9_]+$

  
  generatorFastApiCrudFields:
    description: |
      Field names, comma separated.
      E.g: name,address
      The following fields are included by default:
      - id
      - created_at
      - updated_at
    prompt: Field names
    validation: ^[a-zA-Z0-9_,]*$
  

tasks:

  core.makeDockerTask:
    extend: core.runCoreScript
    private: true
    dependencies:
    - core.showAdv
    - core.isProject
    config:
      imageName: '{{ .GetValue "generatorDockerImageName" }}'
      containerName: '{{ .GetValue "generatorDockerContainerName" }}'
      serviceName: '{{ .GetValue "generatorServiceName" }}'
      templateLocation: '{{ .GetEnv "ZARUBA_HOME" }}/scripts/templates/task/docker/default.zaruba.yaml'
      serviceEnvs: '{{ .GetValue "generatorServiceEnvs" }}'
      dependencies: '{{ .GetValue "generatorTaskDependencies" }}'
      start: |
        {{- $d := .Decoration -}}
        TEMPLATE_LOCATION={{ .EscapeShellArg (.GetConfig "templateLocation") }}
        IMAGE_NAME={{ .EscapeShellArg (.GetConfig "imageName") }}
        CONTAINER_NAME={{ .EscapeShellArg (.GetConfig "containerName") }}
        SERVICE_NAME={{ .EscapeShellArg (.GetConfig "serviceName") }}
        SERVICE_ENVS={{ .EscapeShellArg (.GetConfig "serviceEnvs") }}
        DEPENDENCIES={{ .EscapeShellArg (.GetConfig "dependencies") }}
        create_docker_task "template_location=${TEMPLATE_LOCATION}" "image_name=${IMAGE_NAME}" "container_name=${CONTAINER_NAME}" "service_name=${SERVICE_NAME}" "envs=${SERVICE_ENVS}" "dependencies=${DEPENDENCIES}"
        echo üéâüéâüéâ
        echo "{{ $d.Bold }}{{ $d.Yellow }}Docker task created{{ $d.Normal }}"

 
  core.makePresetDockerTask:
    extend: core.makeDockerTask
    private: true
    config:
      template: ''
      templateLocation: '{{ .GetEnv "ZARUBA_HOME" }}/scripts/templates/task/docker/{{ .GetConfig "template" }}.zaruba.yaml'


  core.makeServiceTask:
    extend: core.runCoreScript
    private: true
    dependencies:
    - core.showAdv
    - core.isProject
    config:
      imageName: '{{ .GetValue "generatorServiceDockerImageName" }}'
      containerName: '{{ .GetValue "generatorServiceDockerContainerName" }}'
      serviceName: '{{ .GetValue "generatorServiceName" }}'
      servicePorts: '{{ .GetValue "generatorServicePorts" }}'
      serviceLocation: '{{ .GetValue "generatorServiceLocation" }}'
      serviceStartCommand: '{{ .GetValue "generatorServiceStartCommand" }}'
      templateLocation: '{{ .GetEnv "ZARUBA_HOME" }}/scripts/templates/task/service/default.zaruba.yaml'
      serviceEnvs: '{{ .GetValue "generatorServiceEnvs" }}'
      dependencies: '{{ .GetValue "generatorTaskDependencies" }}'
      runnerVersion: ''
      start: |
        {{- $d := .Decoration -}}
        TEMPLATE_LOCATION={{ .EscapeShellArg (.GetConfig "templateLocation") }}
        IMAGE_NAME={{ .EscapeShellArg (.GetConfig "imageName") }}
        CONTAINER_NAME={{ .EscapeShellArg (.GetConfig "containerName") }}
        SERVICE_NAME={{ .EscapeShellArg (.GetConfig "serviceName") }}
        SERVICE_PORTS={{ .EscapeShellArg (.GetConfig "servicePorts") }}
        SERVICE_LOCATION={{ .EscapeShellArg (.GetConfig "serviceLocation") }}
        SERVICE_START_COMMAND={{ .EscapeShellArg (.GetConfig "serviceStartCommand") }}
        RUNNER_VERSION={{ .EscapeShellArg (.GetConfig "runnerVersion") }}
        SERVICE_ENVS={{ .EscapeShellArg (.GetConfig "serviceEnvs") }}
        DEPENDENCIES={{ .EscapeShellArg (.GetConfig "dependencies") }}
        create_service_task "template_location=${TEMPLATE_LOCATION}" "service_name=${SERVICE_NAME}" "image_name=${IMAGE_NAME}" "container_name=${CONTAINER_NAME}" "location=${SERVICE_LOCATION}" "start_command=${SERVICE_START_COMMAND}" "ports=${SERVICE_PORTS}" "envs=${SERVICE_ENVS}" "dependencies=${DEPENDENCIES}" "runner_version=${RUNNER_VERSION}"
        echo üéâüéâüéâ
        echo "{{ $d.Bold }}{{ $d.Yellow }}Service task created{{ $d.Normal }}"

 
  core.makePresetServiceTask:
    extend: core.makeServiceTask
    private: true
    config:
      template: ''
      templateLocation: '{{ .GetEnv "ZARUBA_HOME" }}/scripts/templates/task/service/{{ .GetConfig "template" }}.zaruba.yaml'

    
  makeDockerTask:
    icon: üê≥
    extend: core.makeDockerTask
    inputs:
    - generatorDockerImageName
    - generatorDockerContainerName
    - generatorServiceName
    - generatorServiceEnvs
    - generatorTaskDependencies
  

  makeMysqlDockerTask:
    extend: core.makePresetDockerTask
    inputs:
    - generatorDockerContainerName
    - generatorServiceName
    - generatorServiceEnvs
    - generatorTaskDependencies
    config:
      template: mysql

  makePostgreDockerTask:
    extend: core.makePresetDockerTask
    inputs:
    - generatorDockerContainerName
    - generatorServiceName
    - generatorServiceEnvs
    - generatorTaskDependencies
    config:
      template: postgre


  makeRabbitmqDockerTask:
    extend: core.makePresetDockerTask
    inputs:
    - generatorDockerContainerName
    - generatorServiceName
    - generatorServiceEnvs
    - generatorTaskDependencies
    config:
      template: rabbitmq


  makeElasticsearchDockerTask:
    extend: core.makePresetDockerTask
    inputs:
    - generatorDockerContainerName
    - generatorServiceName
    - generatorServiceEnvs
    - generatorTaskDependencies
    config:
      template: elasticsearch


  makeCassandraDockerTask:
    extend: core.makePresetDockerTask
    inputs:
    - generatorDockerContainerName
    - generatorServiceName
    - generatorServiceEnvs
    - generatorTaskDependencies
    config:
      template: cassandra


  makeRedisDockerTask:
    extend: core.makePresetDockerTask
    inputs:
    - generatorDockerContainerName
    - generatorServiceName
    - generatorServiceEnvs
    - generatorTaskDependencies
    config:
      template: redis


  makeMongoDockerTask:
    extend: core.makePresetDockerTask
    inputs:
    - generatorDockerContainerName
    - generatorServiceName
    - generatorServiceEnvs
    - generatorTaskDependencies
    config:
      template: mongo


  makeServiceTask:
    icon: üìú
    extend: core.makeServiceTask
    inputs:
    - generatorServiceLocation
    - generatorServiceName
    - generatorServiceEnvs
    - generatorServiceStartCommand
    - generatorServicePorts
    - generatorServiceDockerImageName
    - generatorServiceDockerContainerName
    - generatorTaskDependencies

  
  makeFastApiServiceTask:
    extend: core.makePresetServiceTask
    inputs:
    - generatorServiceLocation
    - generatorServiceName
    - generatorServiceEnvs
    - generatorServicePorts
    - generatorServiceDockerImageName
    - generatorServiceDockerContainerName
    - generatorTaskDependencies
    config:
      template: fastapi

  
  makeGoServiceTask:
    extend: core.makePresetServiceTask
    inputs:
    - generatorServiceLocation
    - generatorServiceName
    - generatorServiceEnvs
    - generatorServicePorts
    - generatorGoServiceStartCommand
    - generatorTaskDependencies
    - generatorServiceDockerImageName
    - generatorServiceDockerContainerName
    config:
      serviceStartCommand: '{{ .GetValue "generatorGoServiceStartCommand" }}'
      template: go

 
  makeNodeJsServiceTask:
    extend: core.makePresetServiceTask
    inputs:
    - generatorServiceLocation
    - generatorServiceName
    - generatorServiceEnvs
    - generatorServicePorts
    - generatorNodeJsServiceStartCommand
    - generatorNodeJsServiceRunnerVersion
    - generatorTaskDependencies
    - generatorServiceDockerImageName
    - generatorServiceDockerContainerName
    config:
      serviceStartCommand: '{{ .GetValue "generatorNodeJsServiceStartCommand" }}'
      runnerVersion: '{{ .GetValue "generatorNodeJsServiceRunnerVersion" }}'
      template: nodejs

 
  makePythonServiceTask:
    extend: core.makePresetServiceTask
    inputs:
    - generatorServiceLocation
    - generatorServiceName
    - generatorServiceEnvs
    - generatorServicePorts
    - generatorPythonServiceStartCommand
    - generatorTaskDependencies
    - generatorServiceDockerImageName
    - generatorServiceDockerContainerName
    config:
      serviceStartCommand: '{{ .GetValue "generatorPythonServiceStartCommand" }}'
      template: python


  makeStaticServiceTask:
    extend: core.makePresetServiceTask
    inputs:
    - generatorServiceLocation
    - generatorServiceName
    - generatorServiceEnvs
    - generatorServicePorts
    - generatorTaskDependencies
    - generatorServiceDockerImageName
    - generatorServiceDockerContainerName
    config:
      template: static

 
  makeHelmDeployment:
    icon: üö¢
    description: |
      Add helm charts to the project to make deployment easier.
    extend: core.runCoreScript
    dependencies:
    - core.isContainHelmCharts
    - core.showAdv
    inputs:
    - generatorServiceName
    config:
      start: |
        {{- $d := .Decoration -}}
        SERVICE_NAME="{{ .GetValue "generatorServiceName" }}"
        create_helm_deployment "${SERVICE_NAME}"
        echo üéâüéâüéâ
        echo "{{ $d.Bold }}{{ $d.Yellow }}Deployment created{{ $d.Normal }}"
  

  makeFastApiService:
    icon: ‚ö°
    description: Make Fast API service
    extend: core.runCoreScript
    dependencies:
    - core.showAdv
    inputs:
    - generatorFastApiServiceName
    - generatorFastApiCreateTask
    configRef: generatorFastApi
    config:
      start: |
        {{- $d := .Decoration -}}
        {{ .GetConfig "createServiceScript" }}
        echo üéâüéâüéâ
        echo "{{ $d.Bold }}{{ $d.Yellow }}Fast API service created: ${SERVICE_NAME}{{ $d.Normal }}"
        echo "You probably need to check the following files:"
        echo "- ${SERVICE_NAME}/main.py"
        

  makeFastApiModule:
    icon: ‚ö°
    description: Make FastAPI module
    inputs:
    - generatorFastApiServiceName
    - generatorFastApiCreateTask
    - generatorFastApiModuleName
    extend: core.runCoreScript
    dependencies:
    - core.showAdv
    configRef: generatorFastApi
    config:
      start: |
        {{- $d := .Decoration -}}
        {{ .GetConfig "createModuleScript" }}
        echo üéâüéâüéâ
        echo "{{ $d.Bold }}{{ $d.Yellow }}Fast API module created: ${SERVICE_NAME}/${MODULE_NAME}{{ $d.Normal }}"
        echo "You probably need to check the following files:"
        echo "- ${SERVICE_NAME}/main.py"
        echo "- ${SERVICE_NAME}/${MODULE_NAME}/controller.py"
        

  makeFastApiRoute:
    icon: ‚ö°
    description: Make FastAPI route handler
    inputs:
    - generatorFastApiServiceName
    - generatorFastApiCreateTask
    - generatorFastApiModuleName
    - generatorFastApiHttpMethod
    - generatorFastApiUrl
    extend: core.runCoreScript
    dependencies:
    - core.showAdv
    configRef: generatorFastApi
    config:
      templateLocation: '{{ .GetEnv "ZARUBA_HOME" }}/scripts/templates/fastApiModule'
      httpMethod: '{{ .GetValue "generatorFastApiHttpMethod" }}'
      url: '{{ .GetValue "generatorFastApiUrl" }}'
      start: |
        {{- $d := .Decoration -}}
        {{ .GetConfig "createModuleScript" }}
        TEMPLATE_LOCATION={{ .EscapeShellArg (.GetConfig "templateLocation") }}
        SERVICE_NAME={{ .EscapeShellArg (.GetConfig "serviceName") }}
        MODULE_NAME={{ .EscapeShellArg (.GetConfig "moduleName") }}
        URL={{ .EscapeShellArg (.GetConfig "url") }}
        HTTP_METHOD={{ .EscapeShellArg (.GetConfig "httpMethod") }}
        create_fast_route "template_location=${TEMPLATE_LOCATION}" "service_name=${SERVICE_NAME}" "module_name=${MODULE_NAME}" "http_method=${HTTP_METHOD}" "url=${URL}"
        echo üéâüéâüéâ
        echo "{{ $d.Bold }}{{ $d.Yellow }}Fast API Route handler created: ${HTTP_METHOD} ${URL} on ${SERVICE_NAME}/${MODULE_NAME}{{ $d.Normal }}"
        echo "You probably need to check the following files:"
        echo "- ${SERVICE_NAME}/main.py"
        echo "- ${SERVICE_NAME}/${MODULE_NAME}/controller.py"
    

  makeFastApiEventHandler:
    icon: ‚ö°
    description: Make FastAPI event handler
    inputs:
    - generatorFastApiServiceName
    - generatorFastApiCreateTask
    - generatorFastApiModuleName
    - generatorFastApiEventName
    extend: core.runCoreScript
    dependencies:
    - core.showAdv
    configRef: generatorFastApi
    config:
      templateLocation: '{{ .GetEnv "ZARUBA_HOME" }}/scripts/templates/fastApiModule'
      eventName: '{{ .GetValue "generatorFastApiEventName" }}'
      start: |
        {{- $d := .Decoration -}}
        {{ .GetConfig "createModuleScript" }}
        TEMPLATE_LOCATION={{ .EscapeShellArg (.GetConfig "templateLocation") }}
        SERVICE_NAME={{ .EscapeShellArg (.GetConfig "serviceName") }}
        MODULE_NAME={{ .EscapeShellArg (.GetConfig "moduleName") }}
        EVENT_NAME={{ .EscapeShellArg (.GetConfig "eventName") }}
        should_be_dir "./${SERVICE_NAME}/${MODULE_NAME}" "{{ $d.Bold }}{{ $d.Red }}${SERVICE_NAME}/${MODULE_NAME} directory should be exist{{ $d.Normal }}"
        create_fast_event_handler "template_location=${TEMPLATE_LOCATION}" "service_name=${SERVICE_NAME}" "module_name=${MODULE_NAME}" "event_name=${EVENT_NAME}"
        echo üéâüéâüéâ
        echo "{{ $d.Bold }}{{ $d.Yellow }}Fast API event handler created: ${EVENT_NAME} on ${SERVICE_NAME}/${MODULE_NAME}{{ $d.Normal }}"
        echo "You probably need to check the following files:"
        echo "- ${SERVICE_NAME}/main.py"
        echo "- ${SERVICE_NAME}/${MODULE_NAME}/controller.py"


  makeFastApiRpcHandler:
    icon: ‚ö°
    description: Make FastAPI Route
    inputs:
    - generatorFastApiServiceName
    - generatorFastApiCreateTask
    - generatorFastApiModuleName
    - generatorFastApiRpcName
    extend: core.runCoreScript
    dependencies:
    - core.showAdv
    configRef: generatorFastApi
    config:
      templateLocation: '{{ .GetEnv "ZARUBA_HOME" }}/scripts/templates/fastApiModule'
      rpcName: '{{ .GetValue "generatorFastApiRpcName" }}'
      start: |
        {{- $d := .Decoration -}}
        {{ .GetConfig "createModuleScript" }}
        TEMPLATE_LOCATION={{ .EscapeShellArg (.GetConfig "templateLocation") }}
        SERVICE_NAME={{ .EscapeShellArg (.GetConfig "serviceName") }}
        MODULE_NAME={{ .EscapeShellArg (.GetConfig "moduleName") }}
        RPC_NAME={{ .EscapeShellArg (.GetConfig "rpcName") }}
        should_be_dir "./${SERVICE_NAME}/${MODULE_NAME}" "{{ $d.Bold }}{{ $d.Red }}${SERVICE_NAME}/${MODULE_NAME} directory should be exist{{ $d.Normal }}"
        create_fast_rpc_handler "template_location=${TEMPLATE_LOCATION}" "service_name=${SERVICE_NAME}" "module_name=${MODULE_NAME}" "rpc_name=${RPC_NAME}"
        echo üéâüéâüéâ
        echo "{{ $d.Bold }}{{ $d.Yellow }}Fast API RPC handler created: ${RPC_NAME} on ${SERVICE_NAME}/${MODULE_NAME}{{ $d.Normal }}"
        echo "You probably need to check the following files:"
        echo "- ${SERVICE_NAME}/main.py"
        echo "- ${SERVICE_NAME}/${MODULE_NAME}/controller.py"


  makeFastApiCrud:
    icon: ‚ö°
    description: Make FastAPI crud
    inputs:
    - generatorFastApiServiceName
    - generatorFastApiCreateTask
    - generatorFastApiModuleName
    - generatorFastApiCrudEntity
    - generatorFastApiCrudFields
    extend: core.runCoreScript
    dependencies:
    - core.showAdv
    configRef: generatorFastApi
    config:
      templateLocation: '{{ .GetEnv "ZARUBA_HOME" }}/scripts/templates/fastApiCrud'
      entityName: '{{ .GetValue "generatorFastApiCrudEntity" }}'
      fieldNames: '{{ .GetValue "generatorFastApiCrudFields" }}'
      start: |
        {{- $d := .Decoration -}}
        {{ .GetConfig "createModuleScript" }}
        TEMPLATE_LOCATION={{ .EscapeShellArg (.GetConfig "templateLocation") }}
        SERVICE_NAME={{ .EscapeShellArg (.GetConfig "serviceName") }}
        MODULE_NAME={{ .EscapeShellArg (.GetConfig "moduleName") }}
        ENTITY_NAME={{ .EscapeShellArg (.GetConfig "entityName") }}
        FIELD_NAMES={{ .EscapeShellArg (.GetConfig "fieldNames") }}
        should_be_dir "./${SERVICE_NAME}/${MODULE_NAME}" "{{ $d.Bold }}{{ $d.Red }}${SERVICE_NAME} directory should be exist{{ $d.Normal }}"
        create_fast_crud "template_location=${TEMPLATE_LOCATION}" "service_name=${SERVICE_NAME}" "module_name=${MODULE_NAME}" "entity_name=${ENTITY_NAME}" "field_names=${FIELD_NAMES}"
        echo üéâüéâüéâ
        echo "{{ $d.Bold }}{{ $d.Yellow }}Fast API module created: ${SERVICE_NAME}/${MODULE_NAME}{{ $d.Normal }}"
        echo "You probably need to check the following files:"
        echo "- ${SERVICE_NAME}/main.py"
        echo "- ${SERVICE_NAME}/${MODULE_NAME}/controller.py"
        echo "- ${SERVICE_NAME}/${MODULE_NAME}/handle<Entity>Event.py"
        echo "- ${SERVICE_NAME}/${MODULE_NAME}/handle<Entity>Route.py"
        echo "- ${SERVICE_NAME}/repos/<entity>.py"
        echo "- ${SERVICE_NAME}/repos/db<Entity>.py"
        echo "- ${SERVICE_NAME}/schemas/<entity>.py"
tasks:

  prepareZarubaServiceName:
    icon: üêç
    extend: core.runShellScript
    location: zarubaServiceLocation
    timeout: 1h
    envRef: zarubaServiceName
    configRef: zarubaServiceName
    config:
      start: pipenv sync
    lconfigRef: zarubaServiceName
 
  testZarubaServiceName:
    icon: üêç
    extend: core.runShellScript
    location: zarubaServiceLocation
    dependencies:
      - prepareZarubaServiceName
    timeout: 1h
    envRef: zarubaServiceName
    configRef: zarubaServiceName
    config:
      start: pipenv run pytest -rP -v --cov="$(pwd)" --cov-report html
    lconfigRef: zarubaServiceName

  runZarubaServiceName:
    icon: üêç
    extend: core.startService
    location: zarubaServiceLocation
    dependencies:
      - prepareZarubaServiceName
    config:
      start: |
        pipenv run uvicorn main:app --reload --port={{ if .GetEnv "ZARUBA_ENV_PREFIX_HTTP_PORT" }}{{ .GetEnv "ZARUBA_ENV_PREFIX_HTTP_PORT" }}{{ else if .GetEnv "HTTP_PORT" }}{{ .GetEnv "HTTP_PORT" }}{{ else }}3000{{ end }}

   
configs:
  zarubaServiceName: {}

lconfigs:
  zarubaServiceName:
    ports:
    - '{{ if .GetEnv "ZARUBA_ENV_PREFIX_HTTP_PORT" }}{{ .GetEnv "ZARUBA_ENV_PREFIX_HTTP_PORT" }}{{ else if .GetEnv "HTTP_PORT" }}{{ .GetEnv "HTTP_PORT" }}{{ else }}3000{{ end }}'

envs:
  zarubaServiceName:
    PIPENV_DONT_LOAD_ENV:
      from: ZARUBA_SERVICE_NAME_PIPENV_DONT_LOAD_ENV
      default: 1
   

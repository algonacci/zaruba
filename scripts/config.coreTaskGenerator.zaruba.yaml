configs:

  coreTaskGenerator:
    start.declareCommonVariables: |
      {{- $d := .Decoration -}}
      TEMPLATE_LOCATION={{ .EscapeShellArg (.GetConfig "templateLocation") }}
      DESTINATION="./zaruba-tasks"
      SERVICE_ENVS={{ .EscapeShellArg (.GetConfig "serviceEnvs") }}
      if [ "$({{ .Zaruba}} isValidMap "$SERVICE_ENVS")" -eq 0 ]
      then
        echo "{{ $d.Red }}{{ $d.Bold }}${SERVICE_ENVS} is not a valid map{{ $d.Normal }}"
        exit 1
      fi
      SERVICE_PORTS={{ .EscapeShellArg (.GetConfig "servicePorts") }}
      if [ "$({{ .Zaruba}} isValidList "$SERVICE_PORTS")" -eq 0 ]
      then
        echo "{{ $d.Red }}{{ $d.Bold }}${SERVICE_PORTS} is not a valid port{{ $d.Normal }}"
        exit 1
      fi
      DEPENDENCIES={{ .EscapeShellArg (.GetConfig "dependencies") }}
      if [ "$({{ .Zaruba}} isValidList "$DEPENDENCIES")" -eq 0 ]
      then
        echo "{{ $d.Red }}{{ $d.Bold }}${SERVICE_PORTS} is not a valid port{{ $d.Normal }}"
        exit 1
      fi
    start.linkToProject: |
      {{ .Zaruba }} includeFileToProject "./main.zaruba.yaml" "${TASK_FILE_NAME}"
      {{ .Zaruba }} syncProjectEnvFiles "./main.zaruba.yaml"
      if [ "$({{ .Zaruba }} isTaskExist "./main.zaruba.yaml" "build${PASCAL_SERVICE_NAME}Image")" -eq 1 ]
          then
            {{ .Zaruba }} createTaskIfNotExist "./main.zaruba.yaml" "buildImage"
            {{ .Zaruba }} addTaskDependency "./main.zaruba.yaml" "buildImage" "[\"build${PASCAL_SERVICE_NAME}Image\"]"
          fi
      if [ "$({{ .Zaruba }} isTaskExist "./main.zaruba.yaml" "pull${PASCAL_SERVICE_NAME}Image")" -eq 1 ]
      then
        {{ .Zaruba }} createTaskIfNotExist "./main.zaruba.yaml" "pullImage"
        {{ .Zaruba }} addTaskDependency "./main.zaruba.yaml" "pullImage" "[\"pull${PASCAL_SERVICE_NAME}Image\"]"
      fi
      if [ "$({{ .Zaruba }} isTaskExist "./main.zaruba.yaml" "run${PASCAL_SERVICE_NAME}")" -eq 1 ]
      then
        {{ .Zaruba }} createTaskIfNotExist "./main.zaruba.yaml" "run"
        {{ .Zaruba }} addTaskDependency "./main.zaruba.yaml" "run" "[\"run${PASCAL_SERVICE_NAME}\"]"
        {{ .Zaruba }} createTaskIfNotExist "./main.zaruba.yaml" "runContainer"
        {{ .Zaruba }} addTaskDependency "./main.zaruba.yaml" "runContainer" "[\"run${PASCAL_SERVICE_NAME}\"]"
      fi
      if [ "$({{ .Zaruba }} isTaskExist "./main.zaruba.yaml" "stop${PASCAL_SERVICE_NAME}Container")" -eq 1 ]
      then
        {{ .Zaruba }} createTaskIfNotExist "./main.zaruba.yaml" "stopContainer"
        {{ .Zaruba }} addTaskDependency "./main.zaruba.yaml" "stopContainer" "[\"stop${PASCAL_SERVICE_NAME}Container\"]"
      fi
      if [ "$({{ .Zaruba }} isTaskExist "./main.zaruba.yaml" "remove${PASCAL_SERVICE_NAME}Container")" -eq 1 ]
      then
        {{ .Zaruba }} createTaskIfNotExist "./main.zaruba.yaml" "removeContainer"
        {{ .Zaruba }} addTaskDependency "./main.zaruba.yaml" "removeContainer" "[\"remove${PASCAL_SERVICE_NAME}Container\"]"
      fi
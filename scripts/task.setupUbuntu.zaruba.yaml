tasks:

  setupUbuntu:
    icon: ðŸ”¨
    description: Setup ubuntu
    extend: core.runCoreScript
    timeout: 1h
    inputs:
    - setupUserPassword
    - setupAllowRoot
    config:
      beforeStart: |
        {{ $d := .Decoration -}}
        echo "This command will install essential packages for ubuntu/mint/debian. Root privilege is required."
        echo "If this command doesn't run successfully, please open an issue on https://github.com/state-alcemists/zaruba."
        echo "Please also specify your OS version."
      start: |
        {{ $d := .Decoration -}}
        if [ $(whoami) = "root" ]
        then
          {{ if .IsFalse (.GetValue "setupAllowRoot") }}
            if echo "${1}" | grep -q "/root$"
            then
                echo "{{ $d.Bold}}{{ $d.Red }}Your home directory seems to be '/root'. If this is intentional please set 'setupAllowRoot' to 'true'. Otherwise re-run this task with 'sudo -E'{{ $d.Normal}}"
                exit 1
            fi
          {{ end }}
          . "${ZARUBA_HOME}/scripts/setup_ubuntu.sh"
        else
          {{ if .GetValue "setupUserPassword" }}
            echo "${ZARUBA_INPUT_SETUP_USERPASSWORD}" | sudo -E -S {{ .GetConfig "cmd" }} "${ZARUBA_HOME}/scripts/setup_ubuntu.sh"
          {{ else }}
            echo "{{ $d.Bold}}{{ $d.Red }}You need to set 'setupUserPassword' or run this task with 'sudo -E'{{ $d.Normal}}"
            exit 1
          {{ end }}
        fi


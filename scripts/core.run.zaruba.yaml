tasks:

  core.runScript:
    icon: üìî
    description: |
      Run script.
      Common config:
        cmd           : Executable shell name
        cmdArg        : Executable shell argument
        setup         : Setup script
        beforeStart   : Before start script
        start         : Start script
        afterStart    : After start script
        finish        : Finish script
    private: true
    config:
      cmd: '{{ if .GetValue "defaultShell" }}{{ .GetValue "defaultShell" }}{{ else }}bash{{ end }}'
      cmdArg: "-c"
      setup: ''
      beforeStart: ''
      start: ''
      afterStart: ''
      finish: ''
      _setup: ''
      _start: ''
    env:
      PYTHONUNBUFFERED:
        from: PYTHONUNBUFFERED
        default: 1
    start:
    - '{{ .GetConfig "cmd" }}'
    - '{{ .GetConfig "cmdArg" }}'
    - |
        {{ .Trim (.GetConfig "_setup") "\n " }}
        {{ .Trim (.GetConfig "setup") "\n " }}
        {{ .Trim (.GetConfig "beforeStart") "\n " }}
        {{ .Trim (.GetConfig "_start") "\n " }}
        {{ .Trim (.GetConfig "start") "\n " }}
        {{ .Trim (.GetConfig "afterStart") "\n " }}
        {{ .Trim (.GetConfig "finish") "\n " }}


  core.runShellScript:
    icon: üêö
    description: |
      Run shell script
      Common config:
        start : Start script
    private: true
    extend: core.runScript
    dependencies:
    - core.checkBootstrap
    configRefs:
    - core.shell
    config:
      _setup: |
        set -e
        {{ .Trim (.GetConfig "includeBootstrapScript") "\n" }} 
      start: "echo hello world"


  core.runCoreScript:
    icon: üìî
    description: |
      Run script for core tasks
      Common config:
        start : Start script
    private: true
    extend: core.runShellScript
    dependencies:
    - core.checkBootstrap
    config:
      _setup: |
        set -e
        {{ .Trim (.GetConfig "includeBootstrapScript") "\n" }} 
        {{ .Trim (.GetConfig "includeUtilScript") "\n" }} 
      start: echo "No script defined"

  
  core.runNvmScript:
    icon: üê∏
    description: Run shell script under nvm
    private: true
    extend: core.runShellScript
    configRefs:
    - core.shell
    - core.nvm
    config:
      _setup: |
        set -e
        {{ .Trim (.GetConfig "includeBootstrapScript") "\n" }} 
        {{ .Trim (.GetConfig "includeUtilScript") "\n" }} 
        {{ .Trim (.GetConfig "includeNvmScript") "\n" }} 
      start: "echo hello world"

  
  core.prepareNodeJsApp:
    icon: üê∏
    description: Prepare NodeJs Application
    private: true
    extend: core.runNvmScript
    config:
      _setup: |
        set -e
        {{ .Trim (.GetConfig "includeBootstrapScript") "\n" }} 
        {{ .Trim (.GetConfig "includeUtilScript") "\n" }} 
        {{ .Trim (.GetConfig "includeNvmScript") "\n" }} 
      _start: |
        {{ .Trim (.GetConfig "removeNodeModulesScript") "\n" }} 
        {{ .Trim (.GetConfig "npmCleanCacheScript") "\n" }} 
        {{ .Trim (.GetConfig "npmInstallScript") "\n" }} 
        {{ .Trim (.GetConfig "npmRebuildScript") "\n" }} 
        {{ .Trim (.GetConfig "typeScriptInstallScript") "\n" }} 
        {{ .Trim (.GetConfig "typeScriptCompileScript") "\n" }} 
      start: "echo Prepare NodeJs App"
  

  core.preparePythonApp:
    icon: üêç
    description: Prepare Python App
    private: true
    extend: core.runShellScript
    config:
      _start: |
        if [ -f Pipfile "Pipfile.lock" ]
        then
          pipenv sync
        else
          pipenv install
        fi
      start: "echo Prepare Python App"


  core.wrapper:
    private: true
    extend: core.runShellScript
    config:
      start: '{{ .GetConfig "playBellScript" }}'
  

  core.runPythonScript:
    icon: üêç
    description: |
      Run python script
      Common config:
        start : Start script
    private: true
    extend: core.runScript
    config:
      cmd: python
      start: "print('hello world')"


  core.runNodeJsScript:
    icon: üê∏
    description: |
      Run Node.Js script
      Common config:
        start : Start script
    private: true
    extend: core.runScript
    config:
      cmd: node
      cmdArg: "-p"
      start: "console.log('hello world')"


  core.runInContainer:
    icon: üê≥
    description: |
      Run command from inside the container
      Common config:
        containerName : Name of the container
      Common lconfig:
        commands      : list of command to be executed
                        (each command should be in single line)
    private: true
    extend: core.runCoreScript
    configRef: core.docker
    lconfig:
      commands: []
    config:
      _start: |
        {{ $this := . -}}
        {{ range $index, $command := .GetLConfig "commands" -}}
          docker exec "{{ $this.GetConfig "containerName" }}" {{ $command }}
        {{ end -}}

      
  core.mysql.execSql:
    icon: üê¨ 
    private: true
    extend: core.runCoreScript
    lconfig:
      queries: []
    configRef: core.docker
    config:
      user: root
      password: '{{ .GetEnv "MYSQL_ROOT_PASSWORD" }}'
      database: '{{ .GetEnv "MYSQL_DATABASE" }}'
      _start: |
        {{ $this := . -}}
        {{ range $index, $query := .GetLConfig "queries" -}}
          docker exec "{{ $this.GetConfig "containerName" }}" mysql -u {{ $this.GetConfig "user" }} -p{{ $this.GetConfig "password" }} -e {{ $query }}
        {{ end -}}

     
  core.cassandra.execCql:
    icon: üëÄ
    private: true
    extend: core.runCoreScript
    lconfig:
      queries: []
    configRef: core.docker
    config:
      keyspace:  sample
      _start: |
        {{ $this := . -}}
        {{ range $index, $query := .GetLConfig "queries" -}}
          docker exec "{{ $this.GetConfig "containerName" }}" cqlsh -e {{ $query }}
        {{ end -}}
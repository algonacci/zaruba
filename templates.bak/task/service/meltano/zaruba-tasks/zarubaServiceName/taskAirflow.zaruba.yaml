tasks:

  createZarubaServiceNameConfiguratorScript:
    extend: zrbRunShellScript
    location: ../../zarubaServiceName/airflow
    config:
      start: |
        {{ $err := .WriteFile "initWorker.sh" (.ParseFile "initWorker.gotmpl.sh") }}
    configRefs:
      - zarubaServiceNameContainer
      - zarubaServiceName
      - zrbDocker
    envRef: zarubaServiceName

  configureZarubaServiceNameAirflow:
    extend: configureZarubaAirflowServiceWorker
    location: ../../zarubaServiceName/airflow
    dependencies:
      - createZarubaServiceNameConfiguratorScript
      - runZarubaAirflowServiceWorker
    config:
      commands: |
        {{ .ReadFile "initWorker.sh" }}
  
  registerZarubaServiceName:
    extend: zrbRunShellScript
    location: ../../zarubaServiceName/airflow
    dependencies:
      - configureZarubaServiceNameAirflow
      - buildZarubaServiceNameImage
    configRefs:
      - zarubaAirflowServiceWorker
      - zarubaAirflowServiceContainer
    config:
      start: |
        docker cp "./dags" "{{ .GetConfig "containerName" }}:/opt/airflow/dags/zarubaServiceName"

    
tasks:

  testPlayground:
    dependencies:
      - testStopContainers

  testSyncEnv:
    location: ../../../../playground
    extend: zrbRunShellScript 
    dependencies:
      - testAddComponents
    configRef: playgroundTest
    config:
      start: |
        touch .env
        ../zaruba please syncEnv

  testRemoveContainers:
    location: ../../../../playground
    extend: zrbRunShellScript 
    dependencies:
      - testSyncEnv
    configRef: playgroundTest
    config:
      start: |
        ../zaruba please removeContainers

  testStart:
    location: ../../../../playground
    extend: zrbRunShellScript 
    timeout: 1h
    dependencies:
      - testRemoveContainers
    configRef: playgroundTest
    config:
      start: |
        ../zaruba please start -t

  testStartContainers:
    location: ../../../../playground
    extend: zrbRunShellScript 
    timeout: 1h
    dependencies:
      - testStart
    configRef: playgroundTest
    config:
      start: |
        ../zaruba please startContainers -t
        echo "the containers are still running in the background"
        sleep 5

  testFastApi:
    location: ../../../../playground
    extend: zrbRunShellScript 
    dependencies:
      - testStartContainers
    configRef: playgroundTest
    config:
      start: |
        python "{{ .GetTaskPath "test_fastapi.py" }}"

  testMigrateMysql:
    location: ../../../../playground
    extend: zrbRunShellScript 
    dependencies:
      - testStartContainers
    configRef: playgroundTest
    config:
      start: |
        ../zaruba please queryProvoMysql

  testStopContainers:
    location: ../../../../playground
    extend: zrbRunShellScript 
    dependencies:
      - testFastApi
      - testMigrateMysql
    configRef: playgroundTest
    config:
      start: |
        ../zaruba please stopContainers


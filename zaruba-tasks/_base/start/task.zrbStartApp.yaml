tasks:

  zrbStartApp:
    icon: ðŸ“œ
    description: |
      Start service and check it's readiness.
      Common configs:
        setup       : Script to be executed before start service or check service readiness.
        start       : Script to start the service (e.g: python -m http.server 9000).
        beforeStart : Script to be executed before start service.
        afterStart  : Script to be executed after start service.
        beforeCheck : Script to be executed before check service readiness.
        afterCheck  : Script to be executed before check service readiness.
        finish      : Script to be executed after start service or check service readiness.
        runInLocal  : Run service locally or not.
        ports       : Port to be checked to confirm service readiness, separated by new line.
    private: true
    extend: zrbRunShellScript
    dependencies:
      - updateProjectLinks
    autoTerminate: false
    configs:
      beforeStart: ""
      start: ""
      afterStart: ""
      beforeCheck: ""
      ports: ""
      check: |
        {{- $d := .Decoration -}}
        {{ range $index, $port := .Util.Str.Split (.Util.Str.Trim (.GetConfig "ports") "\n ") "\n" -}}
          {{ if ne $port "" -}}
            echo "ðŸ“œ ${_BOLD}${_YELLOW}Waiting for port '{{ $port }}'${_NORMAL}"
            waitPort "localhost" {{ $port }}
            echo "ðŸ“œ ${_BOLD}${_YELLOW}Port '{{ $port }}' is ready${_NORMAL}"
          {{ end -}}
        {{ end -}}
      afterCheck: ""
      runInLocal: true
    start:
      - '{{ .GetConfig "cmd" }}'
      - '{{ .GetConfig "cmdArg" }}'
      - |
        {{- $d := .Decoration -}}
        {{ if .Util.Bool.IsFalse (.GetConfig "runInLocal") -}}
          echo ðŸŽ‰ðŸŽ‰ðŸŽ‰
          echo "ðŸ“œ ${_BOLD}${_YELLOW}Task '{{ .Name }}' is started${_NORMAL}"
          sleep infinity
        {{ end -}}
        {{ .Util.Str.Trim (.GetConfig "_setup") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "setup") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "beforeStart") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "_start") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "start") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "afterStart") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "finish") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "_finish") "\n " }}
        echo ðŸŽ‰ðŸŽ‰ðŸŽ‰
        echo "ðŸ“œ ${_BOLD}${_YELLOW}Task '{{ .Name }}' is started${_NORMAL}"
    check:
      - '{{ .GetConfig "cmd" }}'
      - '{{ .GetConfig "cmdArg" }}'
      - |
        {{- $d := .Decoration -}}
        {{ if .Util.Bool.IsFalse (.GetConfig "runInLocal") -}}
          echo ðŸŽ‰ðŸŽ‰ðŸŽ‰
          echo "ðŸ“œ ${_BOLD}${_YELLOW}Task '{{ .Name }}' is ready${_NORMAL}"
          exit 0
        {{ end -}}
        {{ .Util.Str.Trim (.GetConfig "_setup") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "setup") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "beforeCheck") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "_check") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "check") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "afterCheck") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "finish") "\n " }}
        {{ .Util.Str.Trim (.GetConfig "_finish") "\n " }}
        echo ðŸŽ‰ðŸŽ‰ðŸŽ‰
        echo "ðŸ“œ ${_BOLD}${_YELLOW}Task '{{ .Name }}' is ready${_NORMAL}"
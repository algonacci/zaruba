tasks:

  zrbBuildDockerImage:
    icon: üê≥
    private: true
    description: |
      Build docker image.
      Common configs:
        imageName : Image name
    extend: zrbRunShellScript
    dependencies:
      - updateProjectLinks
    configRef: zrbDocker
    configs:
      buildArg: ""
      start.buildDockerImage.buildArg: |
        {{ range $index, $buildArg := .Util.Str.Split (.Util.Str.Trim (.GetConfig "buildArg") "\n" ) "\n" -}}
          {{ if ne $buildArg "" -}}
            --build-arg {{ $buildArg }} {{ "" -}}
          {{ end -}}
        {{ end -}}
      dockerFilePath: Dockerfile
      start: |
        set -e
        {{ $d := .Decoration -}}
        DOCKER_FILE="{{ .GetConfig "dockerFilePath" }}"
        if [ ! -f "${DOCKER_FILE}" ]
        then
          echo "{{ $d.Bold }}{{ $d.Red }}${DOCKER_FILE} should be exist{{ $d.Normal }}"
          exit 1
        fi
        DOCKER_IMAGE_NAME="{{ .GetDockerImageName }}"
        DOCKER_IMAGE_TAG="{{ .GetConfig "imageTag" }}"
        docker build {{ .GetConfig "start.buildDockerImage.buildArg" }} \
          -t "${DOCKER_IMAGE_NAME}:latest" \
          -t "${DOCKER_IMAGE_NAME}:{{ if .GetConfig "imageTag" }}{{ .GetConfig "imageTag" }}{{ else }}latest{{ end }}" \
          -f "${DOCKER_FILE}" .
        echo üéâüéâüéâ
        echo "{{ $d.Bold }}{{ $d.Yellow }}Docker image built{{ $d.Normal }}"


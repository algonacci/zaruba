tasks:

  zrbRunInDockerContainer:
    icon: üê≥
    description: |
      Run command from inside the container
      Common config:
        containerName  : Name of the container
        containerShell : Shell to run script, default to sh
        command       : Command to be executed, can be multi line
    private: true
    extend: zrbGenerateAndRun
    config:
      containerName: ''
      remoteScriptLocation: '_{{ .Name }}Script'
      remoteCommand: 'sh "{{ .GetConfig "remoteScriptLocation" }}/run.sh"'
      runGeneratedScript: |
        CONTAINER_NAME="{{ .GetConfig "containerName" }}"
        GENERATED_SCRIPT_LOCATION="{{ .GetConfig "generatedScriptLocation" }}"
        REMOTE_SCRIPT_LOCATION="{{ .GetConfig "remoteScriptLocation" }}"
        chmod 755 -R "${GENERATED_SCRIPT_LOCATION}"
        docker cp "${GENERATED_SCRIPT_LOCATION}" "${CONTAINER_NAME}:${REMOTE_SCRIPT_LOCATION}"
        docker exec "${CONTAINER_NAME}" {{ .GetConfig "remoteCommand" }}
        docker exec -u 0 "${CONTAINER_NAME}" rm -Rf "${_REMOTE_SCRIPT_LOCATION}"
        rm -Rf "${GENERATED_SCRIPT_LOCATION}"
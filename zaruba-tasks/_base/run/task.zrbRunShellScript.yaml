tasks:

  zrbRunShellScript:
    icon: üêö
    description: |
      Run shell script
      Common configs:
        start : Start script
    private: true
    extend: zrbRunScript
    configs:
      strictMode: true
      shouldInitUtil: true
      shouldInitConfigVariables: false
      shouldInitConfigMapVariable: false
      shouldInitEnvMapVariable: false
      _initShell: |
        {{ if .Util.Bool.IsTrue (.GetConfig "strictMode") }}set -e{{ else }}set +e{{ end }}
        {{ if .Util.Bool.IsTrue (.GetConfig "shouldInitUtil") }}. {{ .ZarubaHome }}/zaruba-tasks/_base/run/bash/shellUtil.sh{{ else }}{{ "" -}}{{ end }}
        {{ $d := .Decoration -}}
        {{ $d.ToShellVariables }}
        {{ if .Util.Bool.IsTrue (.GetConfig "shouldInitConfigVariables") }}{{ .GetConfigsAsShellVariables "^[^_].*$" "_ZRB_CFG" }}{{ else }}{{ "" -}}{{ end }}
        {{ if .Util.Bool.IsTrue (.GetConfig "shouldInitConfigMapVariable") }}_ZRB_CONFIG_MAP={{ .Util.Str.EscapeShellValue (.Util.Json.FromStringDict (.GetConfigs "^[^_].*$")) }}{{ else }}{{ "" -}}{{ end }}
        {{ if .Util.Bool.IsTrue (.GetConfig "shouldInitEnvMapVariable") }}_ZRB_ENV_MAP={{ .Util.Str.EscapeShellValue (.Util.Json.FromStringDict (.GetEnvs)) }}{{ else }}{{ "" -}}{{ end }}
      _setup: '{{ .Util.Str.Trim (.GetConfig "_initShell") "\n" }}'
      start: "echo hello world"
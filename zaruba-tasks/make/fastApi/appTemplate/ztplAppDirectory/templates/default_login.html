<head>
    {% include 'default-partials/meta.html' %}
    {% include 'default-partials/include-css.html' %}
    <title>{{ context.current_menu.title }}</title>
</head>
<body>
    {% include 'default-partials/navigation.html' %}

    <div id="app" class="container">
        <h1>{{ context.current_menu.title }}</h1>
        {{ vue('message') }}
        {% if context.current_user and context.current_user.username != guest_username %}
            <button type="submit" class="btn btn-primary mb-3" @click="logout">Log out</button>
        {% else %}
            <div class="mb-3">
                <label for="login-username" class="form-label">Username/Email address</label>
                <input type="email" class="form-control" id="login-username" placeholder="name@example.com" v-model="username">
            </div>
            <div class="mb-3">
                <label for="login-password" class="form-label">Password</label>
                <input type="password" class="form-control" id="login-password" placeholder="password" v-model="password">
            </div>
            <div class="mb-3">
                <button type="submit" class="btn btn-primary mb-3" @click="login">Log in</button>
            </div>
        {% endif %}
    </div>

    {% include 'default-partials/include-js.html' %}

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    username: '',
                    password: '',
                    message: '',
                }
            },
            methods: {
                async login() {
                    const formData = new FormData();
                    formData.append('username', this.username);
                    formData.append('password', this.password);
                    const response = await axios.post('{{ backend_host }}{{ access_token_url }}', formData);
                    if (response.status == 200) {
                        document.cookie = `app_auth_token=${response.data.access_token}; path=/`
                        location.reload(true);
                        return;
                    }
                },
                logout() {
                    document.cookie = 'app_auth_token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/'
                    location.reload(true);
                }
            }
        }).mount('#app')
    </script>

</body>
tasks:
 
  makeMeltanoApp:
    icon: üêâ
    extend: makeApp
    inputs:
      - appDirectory
    config:
      templateLocations: |
        [
          "{{ .ZarubaHome }}/zaruba-tasks/make/meltano/appTemplate"
        ]
      _generate: |
        pip install meltano
        pipenv run meltano init "${_ZRB_APP_DIRECTORY}"
        if [ ! -d "${_ZRB_APP_DIRECTORY}" ]
        then
          _ZRB_APP_LOWER_DIRECTORY="$("{{ .ZarubaBin }}" str toLower "${_ZRB_APP_DIRECTORY}")"
          mv "${_ZRB_APP_LOWER_DIRECTORY}" "${_ZRB_APP_DIRECTORY}"
        fi
        {{ .GetConfig "_generateBase" }}

  addMeltano:
    icon: üêâ
    extend: makeNativeAppRunner
    dependencies:
      - makeMeltanoApp
    inputs:
      - appDirectory
      - appDependencies
      - appName
      - appEnvs
      - appImageName
      - appContainerName
    config:
      appIcon: üêâ
      templateLocations: |
        [
          "{{ .ZarubaHome }}/zaruba-tasks/make/_task/appRunner/_base/template",
          "{{ .ZarubaHome }}/zaruba-tasks/make/_task/appRunner/native/template",
          "{{ .ZarubaHome }}/zaruba-tasks/make/meltano/taskTemplate"
        ]
      _integrate: |
        {{ .GetConfig "_registerModule" }}
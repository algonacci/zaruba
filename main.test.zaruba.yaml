tasks:


  testCore:
    icon: 游눌
    location: ./
    extend: core.runShellScript
    dependencies:
    - clearLog
    config:
      start: |
        set -e
        ZARUBA_HOME=""
        mkdir -p ./coverage
        rm -f ./test_resource/alchemy/alembic.txt
        rm -f ./test-resource/log.zaruba.csv
        go test -v ./... --race -coverprofile=./coverage/profile.out -covermode=atomic
        go tool cover -html=./coverage/profile.out -o ./coverage/coverage.html
  

  test:
    icon: 游눌
    dependencies:
    - clearLog
    - testCore
    - testCommon
    - testGeneratedService
    - testPushImage
    - testHelmApply
    - testHelmDestroy
    - stopContainerRegistry


  preparePlayground:
    icon: 游댣
    location: ./
    extend: core.runShellScript
    dependencies:
    - clearLog
    config:
      start: |
        if [ -d playground ]
        then
          chmod 777 -R playground
        fi
        rm -Rf playground
        mkdir -p playground
  

  testSetupPyenv:
    icon: 游눌
    location: ./
    dependencies:
    - clearLog
    - build
    extend: core.runShellScript
    config:
      start: |
        set -e
        ZARUBA_HOME="$(realpath ".")"
        ./zaruba please setupPyenv setup.injectBootstrap=false


  testSetupNvm:
    icon: 游눌
    location: ./
    dependencies:
    - clearLog
    - build
    extend: core.runShellScript
    config:
      start: |
        set -e
        ZARUBA_HOME="$(realpath ".")"
        ./zaruba please setupNvm setup.injectBootstrap=false


  testSetupSdkman:
    icon: 游눌
    location: ./
    dependencies:
    - clearLog
    - build
    extend: core.runShellScript
    config:
      start: |
        set -e
        ZARUBA_HOME="$(realpath ".")"
        ./zaruba please setupSdkman setup.injectBootstrap=false


  testSetupSpark:
    icon: 游눌
    location: ./
    dependencies:
    - clearLog
    - build
    extend: core.runShellScript
    config:
      start: |
        set -e
        ZARUBA_HOME="$(realpath ".")"
        ./zaruba please setupSpark setup.injectBootstrap=false


  testSetupKubeClient:
    icon: 游눌
    location: ./
    dependencies:
    - clearLog
    - build
    extend: core.runShellScript
    config:
      start: |
        set -e
        ZARUBA_HOME="$(realpath ".")"
        ./zaruba please setupKubeClient setup.injectBootstrap=false


  testThanks:
    icon: 游눌
    location: ./
    dependencies:
    - clearLog
    - build
    extend: core.runShellScript
    config:
      start: |
        set -e
        ZARUBA_HOME="$(realpath ".")"
        ./zaruba thanks


  testSorry:
    icon: 游눌
    location: ./
    dependencies:
    - clearLog
    - build
    extend: core.runShellScript
    config:
      start: |
        set -e
        ZARUBA_HOME="$(realpath ".")"
        ./zaruba sorry
  

  testShowVersion:
    icon: 游눌
    location: ./
    dependencies:
    - clearLog
    - build
    extend: core.runShellScript
    config:
      start: |
        set -e
        ZARUBA_HOME="$(realpath ".")"
        ./zaruba please showVersion setup.injectBootstrap=false


  testCommon:
    icon: 游눌
    location: ./
    dependencies:
    - clearLog
    - build
    - testThanks
    - testSorry
    - testShowVersion
    - testSetupPyenv
    - testSetupNvm
    - testSetupSdkman
    - testSetupSpark
    - testSetupKubeClient